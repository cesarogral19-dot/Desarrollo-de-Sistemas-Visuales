@echo off
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM โ                                                                            โ
REM โ               ๐ SCRIPT MAESTRO - INICIA TODO AUTOMรTICAMENTE              โ
REM โ                                                                            โ
REM โ                    MERN Stack 100% Listo para usar                         โ
REM โ                                                                            โ
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

SETLOCAL ENABLEDELAYEDEXPANSION

cls
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  Sistema MERN Stack - Iniciando
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASO 1: VERIFICAR Y CREAR DIRECTORIOS
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo [1/5] Verificando directorios...
if not exist "backend" (
    echo โ Error: No se encuentra la carpeta 'backend'
    echo Por favor, ejecuta este script desde MERN-Stack-Complete
    pause
    exit /b 1
)

if not exist "frontend" (
    echo โ Error: No se encuentra la carpeta 'frontend'
    pause
    exit /b 1
)

if not exist "C:\data\db" (
    echo Creando directorio de datos MongoDB...
    mkdir "C:\data\db" 2>nul
)

echo โ Directorios OK
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASO 2: VERIFICAR MONGODB
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo [2/5] Buscando MongoDB...
set MONGOPATH=C:\Program Files\MongoDB\Server\6.0\bin\mongod.exe

if not exist "%MONGOPATH%" (
    echo โ MongoDB no estรก instalado
    echo.
    echo Descarga MongoDB Community desde:
    echo https://www.mongodb.com/try/download/community
    echo.
    echo Despuรฉs de instalar, vuelve a ejecutar este script.
    echo.
    pause
    exit /b 1
)

echo โ MongoDB encontrado en: %MONGOPATH%
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASO 3: INICIAR MONGODB
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo [3/5] Iniciando MongoDB...
REM Ver si ya estรก corriendo
tasklist /FI "IMAGENAME eq mongod.exe" 2>NUL | find /I "mongod.exe" >NUL

if "%ERRORLEVEL%"=="0" (
    echo โ MongoDB ya estรก corriendo
) else (
    echo Iniciando mongod.exe...
    REM Iniciar MongoDB en ambiente separado
    start "MongoDB Server" "%MONGOPATH%" --dbpath "C:\data\db"
    echo โ MongoDB iniciado
    echo Esperando 5 segundos a que estรฉ listo...
    timeout /t 5 /nobreak
)
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASO 4: INSTALAR DEPENDENCIAS BACKEND
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo [4/5] Preparando Backend...
cd backend

if not exist "node_modules" (
    echo Instalando dependencias del backend...
    call npm install
    if !ERRORLEVEL! neq 0 (
        echo โ Error al instalar dependencias del backend
        pause
        exit /b 1
    )
    echo โ Dependencias instaladas
) else (
    echo โ Dependencias del backend listas
)

cd ..
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASO 5: INSTALAR DEPENDENCIAS FRONTEND
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo [5/5] Preparando Frontend...
cd frontend

if not exist "node_modules" (
    echo Instalando dependencias del frontend...
    call npm install
    if !ERRORLEVEL! neq 0 (
        echo โ Error al instalar dependencias del frontend
        pause
        exit /b 1
    )
    echo โ Dependencias instaladas
) else (
    echo โ Dependencias del frontend listas
)

cd ..
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM INICIAR BACKEND
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

cls
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo โ ยกCONFIGURACIรN COMPLETADA!
echo.
echo Iniciando aplicaciรณn...
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

echo ๐ Abriendo BACKEND...
cd backend
start "MERN Backend - Express API" cmd /k "npm run dev"
cd ..

timeout /t 3 /nobreak

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM INICIAR FRONTEND
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo.
echo ๐จ Abriendo FRONTEND...
cd frontend
start "MERN Frontend - React" cmd /k "npm run dev"
cd ..

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ ยกTODO ESTร CORRIENDO!
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo ๐ Abre en tu navegador:
echo    Frontend: http://localhost:5173
echo    Backend:  http://localhost:5000
echo    MongoDB:  localhost:27017
echo.
echo ๐ Crea una cuenta o usa las credenciales de prueba
echo.
echo ๐ Para detener todo, cierra las ventanas de terminal
echo    O ejecuta: taskkill /IM mongod.exe /F (para MongoDB)
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
pause
